<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="manifest" href="./manifest.json">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta property="og:title" content="Prem Mistry - Zenion Technologies" />
  <meta property="og:description" content="Digital Business Card - Engineering the Future, End to End." />
  <meta name="theme-color" content="#020617">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Zenion Card">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <title>Prem Mistry - Zenion Technologies</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link
    href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap"
    rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Outfit', 'sans-serif'], mono: ['Space Mono', 'monospace'] },
          colors: { brand: { dark: '#020617', cyan: '#38bdf8', violet: '#8b5cf6' } },
          animation: {
            'fade-in-up': 'fadeInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards',
            'shimmer': 'shimmer 3s linear infinite'
          },
          keyframes: {
            fadeInUp: { '0%': { opacity: 0, transform: 'translateY(20px)' }, '100%': { opacity: 1, transform: 'translateY(0)' } },
            shimmer: { '0%': { backgroundPosition: '200% center' }, '100%': { backgroundPosition: '-200% center' } }
          }
        }
      }
    }
  </script>

  <style>
    :root {
      --mx: 50%;
      --my: 50%;
      --rx: 0deg;
      --ry: 0deg;
      --sheen-op: 0;
    }

    html,
    body {
      height: 100%;
      width: 100%;
      overflow: hidden;
      touch-action: manipulation;
      user-select: none;
      -webkit-user-select: none;
    }

    body {
      background-color: #020617;
      color: #fff;
      font-family: 'Outfit', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    * {
      -webkit-tap-highlight-color: transparent;
    }

    #bg-canvas {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
      /* CRITICAL */
    }

    .glass-panel,
    .profile-section,
    #action-container,
    #button-row {
      pointer-events: auto;
      position: relative;
      z-index: 20;
    }

    /* Premium Background Overlay */
    .premium-bg {
      position: fixed;
      inset: 0;
      background:
        radial-gradient(circle at 15% 50%, rgba(56, 189, 248, 0.08), transparent 25%),
        radial-gradient(circle at 85% 30%, rgba(139, 92, 246, 0.08), transparent 25%);
      z-index: 1;
      pointer-events: none;
    }

    .wrap {
      position: relative;
      z-index: 10;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      perspective: 1200px;
      transition: all 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    /* FIX: Added visibility hidden so buttons are NOT clickable when game is active */
    .wrap.game-mode {
      opacity: 0;
      transform: scale(0.8) translateY(50px);
      pointer-events: none;
      filter: blur(10px);
      visibility: hidden;
      /* Delay visibility toggle to allow fade out */
      transition: opacity 0.6s cubic-bezier(0.2, 0.8, 0.2, 1), transform 0.6s cubic-bezier(0.2, 0.8, 0.2, 1), visibility 0s 0.6s;
    }

    #scaler {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      transition: transform 0.1s ease-out;
    }

    .card3d {
      width: min(380px, 90vw);
      position: relative;
      transform-style: preserve-3d;
      will-change: transform;
      opacity: 0;
      transform: translateY(30px) rotateX(10deg);
      transition: opacity 0.8s ease, transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    .card3d.loaded {
      opacity: 1;
      transform: translateY(0) rotateX(0deg);
    }

    /* FIX: Added transform-style: preserve-3d to allow buttons to lift off the glass */
    .glass-panel {
      position: relative;
      border-radius: 32px;
      background: rgba(15, 23, 42, 0.65);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow:
        0 25px 50px -12px rgba(0, 0, 0, 0.7),
        0 0 0 1px rgba(255, 255, 255, 0.03) inset;
      overflow: hidden;
      transform: rotateX(var(--rx)) rotateY(var(--ry));
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      transform-style: preserve-3d;
    }

    .glass-panel::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at var(--mx) var(--my), rgba(255, 255, 255, 0.1), transparent 50%);
      opacity: var(--sheen-op);
      mix-blend-mode: overlay;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 2;
    }

    .border-glow {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(56, 189, 248, 0.5), rgba(139, 92, 246, 0.5), transparent);
      z-index: 3;
      opacity: 0.6;
    }

    .banner-area {
      height: 140px;
      position: relative;
      overflow: hidden;
      z-index: 0;
      transform: translateZ(0);
    }

    .banner-area::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(to bottom, transparent 0%, rgba(15, 23, 42, 0.85) 90%);
    }

    .banner-area img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scale(1.05);
      transition: transform 3s ease;
    }

    .glass-panel:hover .banner-area img {
      transform: scale(1.10);
    }

    .profile-section {
      margin-top: -65px;
      padding: 0 24px 30px;
      position: relative;
      z-index: 5;
      transform-style: preserve-3d;
    }

    .avatar-wrapper {
      width: 104px;
      height: 104px;
      margin: 0 auto;
      border-radius: 50%;
      padding: 4px;
      background: linear-gradient(135deg, rgba(56, 189, 248, 0.5), rgba(139, 92, 246, 0.5));
      position: relative;
      box-shadow: 0 15px 35px -10px rgba(0, 0, 0, 0.5);
      transform: translateZ(20px);
    }

    .avatar-inner {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: #0f172a;
      border: 4px solid #0f172a;
      overflow: hidden;
      position: relative;
    }

    .avatar-inner img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .stagger-1 {
      animation-delay: 100ms;
      opacity: 0;
    }

    .stagger-2 {
      animation-delay: 200ms;
      opacity: 0;
    }

    .stagger-3 {
      animation-delay: 300ms;
      opacity: 0;
    }

    .stagger-4 {
      animation-delay: 400ms;
      opacity: 0;
    }

    .stagger-5 {
      animation-delay: 500ms;
      opacity: 0;
    }

    /* FIX: Added translateZ to lift buttons and touch-action for better response */
    .action-btn {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      position: relative;
      overflow: hidden;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      transform: translateZ(30px);
      /* LIFTING BUTTON */
    }

    .action-btn:active {
      transform: translateZ(25px) scale(0.95);
      background: rgba(56, 189, 248, 0.15);
      border-color: rgba(56, 189, 248, 0.6);
      box-shadow: 0 0 20px rgba(56, 189, 248, 0.4);
    }

    @media(hover: hover) {
      .action-btn:hover {
        background: rgba(255, 255, 255, 0.08);
        border-color: rgba(255, 255, 255, 0.2);
        transform: translateZ(35px) translateY(-2px);
      }
    }

    /* Sleek Immersive Buttons */
    .immersive-btn {
      position: relative;
      width: 48px;
      height: 48px;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.06);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), background 0.3s, border-color 0.3s;
      color: #94a3b8;
      overflow: hidden;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      will-change: transform;
      transform: translateZ(30px);
      pointer-events: auto;
      /* Ensures clicks register */
    }

    .immersive-btn::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at center, var(--btn-color), transparent 60%);
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 0;
    }

    .immersive-btn i {
      position: relative;
      z-index: 10;
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      font-size: 1.1rem;
    }

    /* Combined Hover/Active State class for JS scrubbing */
    .immersive-btn.is-hovered,
    .immersive-btn:hover {
      transform: translateZ(40px) translateY(-6px) scale(1.1);
      border-color: rgba(255, 255, 255, 0.3);
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.5);
    }

    .immersive-btn.is-hovered::before,
    .immersive-btn:hover::before {
      opacity: 0.3;
    }

    .immersive-btn.is-hovered i,
    .immersive-btn:hover i {
      transform: scale(1.2);
      text-shadow: 0 0 15px var(--btn-color);
    }

    .immersive-btn:active {
      transform: translateZ(30px) scale(0.95) translateY(0);
      transition-duration: 0.1s;
      box-shadow: 0 0 15px var(--btn-color);
      border-color: var(--btn-color);
    }

    .info-chip {
      background: rgba(15, 23, 42, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 12px;
      transition: all 0.3s ease;
      position: relative;
      transform: translateZ(10px);
    }

    .info-chip:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(56, 189, 248, 0.2);
    }

    /* FIX: Primary Button Lift */
    .primary-btn {
      background: linear-gradient(135deg, #0ea5e9 0%, #6366f1 100%);
      color: white;
      border: none;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 20px -5px rgba(56, 189, 248, 0.5);
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      transform: translateZ(30px);
      /* LIFTING BUTTON */
    }

    .primary-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.25), transparent);
      transition: 0.5s;
    }

    .primary-btn:hover::before {
      left: 100%;
    }

    .primary-btn:active {
      transform: translateZ(25px) scale(0.98);
    }

    /* Holographic/Prism Button */
    .holo-btn {
      width: 100%;
      padding: 16px;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: white;
      font-weight: 600;
      letter-spacing: 0.02em;
      font-size: 0.9rem;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      transform: translateZ(25px);
      touch-action: manipulation;
      pointer-events: auto;
    }

    .holo-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -50%;
      width: 200%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(56, 189, 248, 0.2), rgba(139, 92, 246, 0.2), transparent);
      transform: skewX(-20deg);
      background-size: 200% auto;
      animation: shimmer 4s linear infinite;
      pointer-events: none;
    }

    .holo-btn:hover {
      background: rgba(255, 255, 255, 0.06);
      border-color: rgba(255, 255, 255, 0.2);
      transform: translateZ(35px) translateY(-1px);
      box-shadow: 0 8px 30px rgba(56, 189, 248, 0.15);
    }

    .modal-backdrop {
      touch-action: none;
    }


    .holo-btn:active {
      transform: translateZ(25px) scale(0.98);
      box-shadow: 0 0 25px rgba(56, 189, 248, 0.5);
      border-color: rgba(56, 189, 248, 0.8);
    }

    .game-ui {
      position: fixed;
      inset: 0;
      z-index: 40;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.4s ease;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 24px;
      background: radial-gradient(circle at center, transparent 0%, #000 120%);
    }

    .game-ui.active {
      opacity: 1;
    }

    .hud-box {
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 10px 16px;
      border-radius: 12px;
      border-left: 3px solid #38bdf8;
    }

    .hp-bar-container {
      width: 140px;
      height: 6px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 99px;
      overflow: hidden;
      margin-top: 6px;
    }

    .hp-bar-fill {
      width: 100%;
      height: 100%;
      background: #38bdf8;
      transition: width 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 0 10px #38bdf8;
    }

    .game-btn {
      position: fixed;
      bottom: 25px;
      right: 35px;
      z-index: 100;

      width: 44px;
      height: 44px;

      background: rgba(15, 23, 42, 0.75);
      backdrop-filter: blur(14px);

      border: 1px solid rgba(56, 189, 248, 0.25);
      border-radius: 999px;

      color: #38bdf8;
      display: flex;
      align-items: center;
      justify-content: center;

      box-shadow:
        0 8px 20px rgba(0, 0, 0, 0.45),
        inset 0 0 0 1px rgba(255, 255, 255, 0.03);

      transition:
        transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1),
        box-shadow 0.25s,
        border-color 0.25s,
        background 0.25s;

      cursor: pointer;
      pointer-events: auto;
      -webkit-tap-highlight-color: transparent;
    }


    .game-btn:hover {
      transform: scale(1.08);
      border-color: rgba(56, 189, 248, 0.6);
      box-shadow:
        0 10px 28px rgba(56, 189, 248, 0.25),
        0 0 0 1px rgba(56, 189, 248, 0.15);
    }


    .game-btn:active {
      transform: scale(0.92);
    }

    .game-btn.active {
      background: rgba(239, 68, 68, 0.9);
      border-color: rgba(239, 68, 68, 0.9);
      color: white;

      box-shadow:
        0 10px 30px rgba(239, 68, 68, 0.35),
        inset 0 0 0 1px rgba(255, 255, 255, 0.15);
    }


    .game-over-screen {
      position: absolute;
      inset: 0;
      z-index: 50;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(8px);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .game-over-screen.active {
      opacity: 1;
      pointer-events: auto;
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      z-index: 50;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .modal-backdrop.active {
      opacity: 1;
      pointer-events: auto;
    }

    .modal-content {
      background: #0f172a;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 24px;
      padding: 24px;
      width: min(340px, 90vw);
      transform: scale(0.9);
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 25px 60px -12px rgba(0, 0, 0, 0.8);
    }

    .modal-backdrop.active .modal-content {
      transform: scale(1);
    }

    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #fff;
      padding: 12px 24px;
      border-radius: 99px;
      font-weight: 500;
      font-size: 0.9rem;
      opacity: 0;
      transition: all 0.3s;
      pointer-events: none;
      z-index: 200;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
</head>

<body>

  <canvas id="bg-canvas"></canvas>
  <div class="premium-bg"></div>

  <div id="game-ui" class="game-ui">
    <div class="flex justify-between items-start w-full">
      <div class="hud-box">
        <div class="text-[10px] text-cyan-400 font-mono tracking-widest opacity-80">SCORE</div>
        <div class="text-3xl font-mono font-bold text-white leading-none" id="score-display">0</div>
        <div class="mt-2">
          <div class="text-[10px] text-cyan-400 font-mono tracking-widest opacity-80">SHIELDS</div>
          <div class="hp-bar-container">
            <div class="hp-bar-fill" id="hp-bar"></div>
          </div>
        </div>
      </div>
      <div class="text-right">
        <div class="text-[10px] font-mono text-white/50 tracking-wider">HIGH SCORE</div>
        <div class="text-xl font-mono font-bold text-violet-400" id="high-score-display">0</div>
      </div>
    </div>
    <div class="text-center mb-12 pointer-events-none">
      <div class="text-cyan-500/40 font-mono text-xs tracking-[0.4em] animate-pulse" id="game-hint">
        <i class="fas fa-crosshairs mr-2"></i>ENGAGE TARGETS
      </div>
    </div>
    <div id="game-over" class="game-over-screen">
      <div class="text-6xl text-red-500 mb-4 opacity-80"><i class="fas fa-exclamation-triangle"></i></div>
      <h2 class="text-4xl font-black text-white mb-2 tracking-tight font-mono">CRITICAL FAILURE</h2>
      <p class="text-cyan-400 font-mono text-lg mb-8 tracking-widest">FINAL SCORE: <span id="final-score"
          class="text-white">0</span></p>
      <button onclick="restartGame()"
        class="group relative px-8 py-3 bg-cyan-500 text-black font-bold rounded-full overflow-hidden transition-transform hover:scale-105 active:scale-95 shadow-[0_0_20px_rgba(6,182,212,0.5)]">
        <span class="relative z-10">REBOOT SYSTEM</span>
        <div
          class="absolute inset-0 bg-white/30 translate-y-full group-hover:translate-y-0 transition-transform duration-300">
        </div>
      </button>
      <button onclick="toggleGame()"
        class="mt-6 text-xs text-white/40 hover:text-white font-mono tracking-widest uppercase hover:underline underline-offset-4 transition-colors">
        Return to Interface
      </button>
    </div>
  </div>

  <button id="game-toggle" class="game-btn" onclick="toggleGame()" title="Toggle Interface Mode">
    <i class="fas fa-gamepad text-lg"></i>
  </button>

  <div class="wrap" id="main-wrap">
    <div id="scaler">
      <div class="card3d" id="card">
        <div class="glass-panel" id="glass">
          <div class="border-glow"></div>
          <!-- Banner -->
          <div class="banner-area"> <img src="images/banner.jpg" alt="Banner"
              onerror="this.src='https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=1000&auto=format&fit=crop'" />
          </div>
          <div class="profile-section">
            <div class="avatar-wrapper animate-fade-in-up stagger-1">
              <div class="avatar-inner">
                <div id="avatar-fallback"
                  class="bg-slate-800 w-full h-full flex items-center justify-center text-slate-500 font-bold text-2xl">
                  PM</div>
                <img src="images/profile.jpg" alt="Prem Mistry"
                  onload="document.getElementById('avatar-fallback').style.display='none'"
                  onerror="this.style.display='none'">
              </div>
            </div>
            <div class="text-center mt-4 animate-fade-in-up stagger-2" style="transform: translateZ(15px);">
              <h1 class="text-2xl font-bold tracking-tight text-white drop-shadow-lg">Prem Mistry</h1>
              <div class="flex items-center justify-center gap-2 mt-2 opacity-90">
                <div class="h-[1px] w-6 bg-gradient-to-r from-transparent to-cyan-400"></div>
                <p class="text-[11px] font-bold tracking-[0.2em] text-cyan-300 uppercase">Zenion Technologies</p>
                <div class="h-[1px] w-6 bg-gradient-to-l from-transparent to-cyan-400"></div>
              </div>
              <p class="text-xs text-slate-300 mt-3 font-light tracking-wide opacity-80">"Engineering the Future, End to
                End."</p>
            </div>
            <!-- BUTTON ROW WITH HAPTIC SCRUBBING -->
            <div class="flex justify-center gap-3 mt-6 animate-fade-in-up stagger-3" id="button-row">
              <!-- Phone: Cyan -->
              <a href="tel:+919408075958" class="immersive-btn haptic-target" style="--btn-color: #06b6d4;">
                <i class="fas fa-phone"></i>
              </a>
              <!-- Email: Pink/Rose -->
              <a href="mailto:info@zeniontechnologies.com" class="immersive-btn haptic-target"
                style="--btn-color: #f472b6;">
                <i class="fas fa-envelope"></i>
              </a>
              <!-- Web: Violet -->
              <a href="https://www.zeniontechnologies.com" target="_blank" class="immersive-btn haptic-target"
                style="--btn-color: #8b5cf6;">
                <i class="fas fa-globe"></i>
              </a>
              <!-- WhatsApp: Green -->
              <button onclick="openWhatsApp()" class="immersive-btn haptic-target" style="--btn-color: #22c55e;">
                <i class="fab fa-whatsapp text-xl"></i>
              </button>
              <!-- LinkedIn: Blue -->
              <a href="https://www.linkedin.com/in/prem-mistry21" target="_blank" class="immersive-btn haptic-target"
                style="--btn-color: #3b82f6;">
                <i class="fab fa-linkedin-in"></i>
              </a>
            </div>
            <div class="grid grid-cols-2 gap-3 mt-6 animate-fade-in-up stagger-4">
              <div class="info-chip group">
                <div class="flex items-center gap-2 mb-2">
                  <div
                    class="w-6 h-6 rounded-full bg-cyan-500/20 flex items-center justify-center text-cyan-400 text-xs border border-cyan-500/20 group-hover:bg-cyan-500/30 transition-colors">
                    <i class="fas fa-bolt"></i>
                  </div>
                  <span class="text-sm font-bold text-white tracking-wide">Innovation</span>
                </div>
                <p
                  class="text-[10px] text-slate-400 leading-snug font-medium group-hover:text-slate-200 transition-colors">
                  Future-ready solutions with a product mindset.</p>
              </div>
              <div class="info-chip group">
                <div class="flex items-center gap-2 mb-2">
                  <div
                    class="w-6 h-6 rounded-full bg-violet-500/20 flex items-center justify-center text-violet-400 text-xs border border-violet-500/20 group-hover:bg-violet-500/30 transition-colors">
                    <i class="fas fa-microchip"></i>
                  </div>
                  <span class="text-sm font-bold text-white tracking-wide">Engineering</span>
                </div>
                <p
                  class="text-[10px] text-slate-400 leading-snug font-medium group-hover:text-slate-200 transition-colors">
                  End-to-end delivery with strong execution.</p>
              </div>
            </div>

            <!-- Added ID for Stability check -->
            <div class="flex flex-col gap-3 mt-6 animate-fade-in-up stagger-5" id="action-container">
              <!-- Holographic Button -->
              <button onclick="openQR()" class="holo-btn group haptic-target">
                <div
                  class="flex items-center justify-center w-6 h-6 rounded-full bg-white/10 group-hover:bg-white/20 transition-colors">
                  <i class="fas fa-qrcode text-xs text-white"></i>
                </div>
                <span class="text-white/90 group-hover:text-white transition-colors">Connect via QR</span>
              </button>
              <div class="grid grid-cols-2 gap-3">
                <button onclick="saveContact()"
                  class="action-btn py-3 rounded-xl font-medium text-xs text-slate-300 hover:text-white flex items-center justify-center gap-2 haptic-target"><i
                    class="fas fa-user-plus text-xs"></i> Save Contact</button>
                <button onclick="shareCard()"
                  class="action-btn py-3 rounded-xl font-medium text-xs text-slate-300 hover:text-white flex items-center justify-center gap-2 haptic-target"><i
                    class="fas fa-share-nodes text-xs"></i> Share Profile</button>
              </div>

              <!-- PWA Install Button (initially hidden, will appear when available) -->
              <button
                id="pwa-install-btn"
                onclick="installPWA()"
                class="action-btn py-3 rounded-xl font-medium text-xs text-slate-300 hover:text-white flex items-center justify-center gap-2 haptic-target hidden"
                aria-hidden="true"
              >
                <i class="fas fa-download text-xs"></i> Install App
              </button>

            </div>
            <div class="text-center mt-6">
              <a href="https://www.zeniontechnologies.com" target="_blank" rel="noopener noreferrer"
                class="group inline-block">
                <p class="text-[9px] tracking-[0.3em] uppercase font-bold text-slate-500
             group-hover:text-cyan-400 transition-colors duration-300">
                  © <span id="copyright-year"></span> Zenion Technologies · All rights reserved
                </p>
              </a>
            </div>

          </div>
        </div>
      </div>
    </div>

    <div id="qr-modal" class="modal-backdrop" onclick="closeQR()">
      <div class="modal-content" onclick="event.stopPropagation()">
        <div class="text-center">
          <div
            class="w-12 h-12 bg-cyan-500/10 rounded-full flex items-center justify-center mx-auto mb-4 text-cyan-400 ring-1 ring-cyan-500/20">
            <i class="fas fa-qrcode text-xl"></i>
          </div>
          <h3 class="text-lg font-bold text-white mb-1">Scan to Save Contact</h3>
          <p class="text-xs text-slate-400 mb-5">
            Scan to instantly save my contact details
          </p>
          <div class="bg-white p-3 rounded-xl inline-block shadow-lg">
            <div id="qr-code"></div>
          </div>
          <div class="grid grid-cols-2 gap-3 mt-6">
            <button onclick="downloadQR()"
              class="py-2.5 rounded-lg border border-white/10 text-xs font-semibold text-slate-300 hover:bg-white/5 transition-colors"><i
                class="fas fa-download mr-1"></i> Download</button>
            <button onclick="closeQR()"
              class="py-2.5 rounded-lg bg-white/10 text-xs font-semibold text-white hover:bg-white/20 transition-colors">Close</button>
          </div>
        </div>
      </div>
    </div>

    <div id="toast" class="toast"><i class="fas fa-check-circle text-green-400"></i><span id="toast-msg">Action
        Successful</span></div>

    <script>
      var canvas = document.getElementById('bg-canvas');
      var ctx = canvas.getContext('2d');

      let width, height;

      // Game State
      let gameActive = false, isGameOver = false, score = 0;
      let highScore = 0;
      try { highScore = parseInt(localStorage.getItem('zenion-hs')) || 0; } catch (e) { }

      let player = { x: 0, y: 0, size: 20, hp: 100, maxHp: 100 };
      let bullets = [], enemies = [], ambientNodes = [], stars = [], particles = [];
      let lastTime = 0, shakeAmount = 0;

      // Input
      const input = { x: null, y: null, down: false };

      function handleMove(x, y) { input.x = x; input.y = y; }

      window.addEventListener('mousemove', e => handleMove(e.clientX, e.clientY), { passive: true });
      window.addEventListener('touchmove', e => {
        if (e.touches.length > 0) handleMove(e.touches[0].clientX, e.touches[0].clientY);
      }, { passive: true });

      window.addEventListener('mousedown', () => input.down = true, { passive: true });
      window.addEventListener('mouseup', () => input.down = false, { passive: true });
      window.addEventListener('touchstart', e => {
        input.down = true;
        if (e.touches.length > 0) handleMove(e.touches[0].clientX, e.touches[0].clientY);
      }, { passive: true });
      window.addEventListener('touchend', () => input.down = false, { passive: true });

      document.getElementById('high-score-display').innerText = highScore;

      function toggleGame() {
        if (gameActive || isGameOver) stopGame();
        else startGame();
      }

      function startGame() {
        gameActive = true; isGameOver = false;
        document.getElementById('main-wrap').classList.add('game-mode');
        document.getElementById('game-ui').classList.add('active');
        const btn = document.getElementById('game-toggle');
        btn.classList.add('active');
        btn.querySelector('i').className = "fas fa-times text-lg";
        restartGameLogic();
      }

      function stopGame() {
        gameActive = false; isGameOver = false;
        document.getElementById('main-wrap').classList.remove('game-mode');
        document.getElementById('game-ui').classList.remove('active');
        document.getElementById('game-over').classList.remove('active');
        const btn = document.getElementById('game-toggle');
        btn.classList.remove('active');
        btn.querySelector('i').className = "fas fa-gamepad text-lg";
        initAmbient();
      }

      function restartGame() {
        document.getElementById('game-over').classList.remove('active');
        restartGameLogic();
      }

      function restartGameLogic() {
        score = 0; shakeAmount = 0; isGameOver = false;
        player.hp = player.maxHp;
        document.getElementById('score-display').innerText = "0";
        updateHpBar();
        bullets = [];
        enemies = [];
        particles = [];
        player.x = width / 2; player.y = height - 100;
      }

      function updateHpBar() {
        const pct = Math.max(0, (player.hp / player.maxHp) * 100);
        const bar = document.getElementById('hp-bar');
        bar.style.width = pct + '%';
        bar.style.backgroundColor = pct < 30 ? '#ef4444' : '#38bdf8';
        bar.style.boxShadow = pct < 30 ? '0 0 10px #ef4444' : '0 0 10px #38bdf8';
      }

      // --- Entities ---
      class Star {
        constructor() {
          this.x = Math.random() * width; this.y = Math.random() * height;
          this.z = Math.random() * 2 + 0.5; this.size = Math.random() * 1.5; this.alpha = Math.random() * 0.5 + 0.1;
        }
        update(speedY) {
          this.y += speedY * this.z;
          if (this.y > height) { this.y = -10; this.x = Math.random() * width; }
        }
        draw() { ctx.fillStyle = `rgba(255,255,255,${this.alpha})`; ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill(); }
      }

      class Particle {
        constructor(x, y, color, speed, life) {
          this.x = x; this.y = y; this.color = color; this.life = life; this.maxLife = life;
          const angle = Math.random() * Math.PI * 2;
          const spd = Math.random() * speed;
          this.vx = Math.cos(angle) * spd; this.vy = Math.sin(angle) * spd;
          this.size = Math.random() * 3 + 1; this.decay = Math.random() * 0.03 + 0.01;
        }
        update() { this.x += this.vx; this.y += this.vy; this.vx *= 0.95; this.vy *= 0.95; this.life -= this.decay; }
        draw() {
          ctx.globalAlpha = Math.max(0, this.life / this.maxLife);
          ctx.fillStyle = `rgb(${this.color})`;
          ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill();
          ctx.globalAlpha = 1;
        }
      }

      class AmbientNode {
        constructor() {
          this.x = Math.random() * width; this.y = Math.random() * height;
          this.vx = (Math.random() - 0.5) * 0.5; this.vy = (Math.random() - 0.5) * 0.5;
          this.color = Math.random() > 0.5 ? '56, 189, 248' : '139, 92, 246';
        }
        update() {
          this.x += this.vx; this.y += this.vy;
          if (this.x < 0 || this.x > width) this.vx *= -1;
          if (this.y < 0 || this.y > height) this.vy *= -1;
        }
        draw() {
          ctx.fillStyle = `rgba(${this.color}, 0.5)`;
          ctx.beginPath(); ctx.arc(this.x, this.y, 1.5, 0, Math.PI * 2); ctx.fill();
        }
      }

      class Enemy {
        constructor(type) {
          this.x = Math.random() * width; this.y = -30; this.type = type;
          this.vx = (Math.random() - 0.5) * 2; this.vy = Math.random() * 2 + 1;
          if (type === 'chaser') { this.color = '239, 68, 68'; this.size = 10; this.hp = 3; }
          else { this.color = '167, 139, 250'; this.size = 14; this.hp = 1; }
          this.dead = false;
        }
        update() {
          if (this.type === 'chaser') {
            const dx = player.x - this.x; const dy = player.y - this.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            if (dist > 0) { this.vx += (dx / dist) * 0.15; this.vy += (dy / dist) * 0.15; }
            const spd = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
            if (spd > 5) { this.vx *= 0.9; this.vy *= 0.9; }
          }
          this.x += this.vx; this.y += this.vy;
          if (this.y > height + 50) this.dead = true;
          if (this.x < -20) this.x = width + 20; if (this.x > width + 20) this.x = -20;
        }
        draw() {
          ctx.shadowBlur = 15; ctx.shadowColor = `rgb(${this.color})`; ctx.fillStyle = `rgb(${this.color})`;
          ctx.beginPath();
          if (this.type === 'chaser') {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(Math.atan2(this.vy, this.vx) + Math.PI / 2);
            ctx.moveTo(0, -this.size);
            ctx.lineTo(this.size, this.size);
            ctx.lineTo(-this.size, this.size);
            ctx.restore();
          } else {
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
          }
          ctx.fill();
          ctx.shadowBlur = 0;
        }
      }

      class Bullet {
        constructor(x, y) {
          this.x = x; this.y = y; this.vy = -15; this.size = 4; this.dead = false;
          // Create particles on fire
          for (let i = 0; i < 2; i++) {
            particles.push(new Particle(x, y - 10, '56, 189, 248', 5, 0.5));
          }


        }
        update() { this.y += this.vy; if (this.y < -20) this.dead = true; }
        draw() {
          ctx.shadowBlur = 10; ctx.shadowColor = '#38bdf8'; ctx.fillStyle = '#fff';
          ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill(); ctx.shadowBlur = 0;
        }
      }

      function initAmbient() {
        ambientNodes = [];
        stars = [];
        const num = Math.max(10, Math.floor((width * height) / 15000));
        for (let i = 0; i < num; i++) ambientNodes.push(new AmbientNode());
        for (let i = 0; i < 80; i++) stars.push(new Star());
      }

      function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
        if (!gameActive) initAmbient();
        else {
          player.x = Math.min(width, Math.max(0, player.x));
          player.y = Math.min(height, Math.max(0, player.y));
        }
        fitCard();
      }

      let fireCooldown = 0;

      function loop(timestamp) {
        if (!lastTime) lastTime = timestamp;

        try {
          ctx.save();

          if (shakeAmount > 0) {
            ctx.translate((Math.random() - 0.5) * shakeAmount, (Math.random() - 0.5) * shakeAmount);
            shakeAmount *= 0.9;
            if (shakeAmount < 0.5) shakeAmount = 0;
          }

          ctx.fillStyle = '#020617';
          ctx.fillRect(0, 0, width, height);

          // Stars (always)
          const starSpeed = gameActive ? 8 : 0.5;
          stars.forEach(s => { s.update(starSpeed); s.draw(); });

          if (gameActive && !isGameOver) {
            // Spawn enemies
            const rate = Math.max(0.005, Math.min(0.04, 0.005 + (score / 10000)));
            if (Math.random() < rate) {
              enemies.push(new Enemy(Math.random() < 0.25 ? 'chaser' : 'basic'));
            }

            // Player tracking
            const targetX = input.x || width / 2;
            const targetY = input.y || height - 100;
            player.x += (targetX - player.x) * 0.12;
            player.y += (targetY - player.y) * 0.12;

            // Draw player
            ctx.save();
            ctx.translate(player.x, player.y);
            ctx.shadowBlur = 20; ctx.shadowColor = '#0ea5e9'; ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.moveTo(0, -24);
            ctx.lineTo(16, 16);
            ctx.lineTo(0, 8);
            ctx.lineTo(-16, 16);
            ctx.fill();

            if (input.down) {
              ctx.fillStyle = '#f59e0b';
              ctx.beginPath();
              ctx.moveTo(-6, 16);
              ctx.lineTo(0, 30 + Math.random() * 15);
              ctx.lineTo(6, 16);
              ctx.fill();
            }
            ctx.restore();

            // Fire
            if (input.down && fireCooldown <= 0) {
              bullets.push(new Bullet(player.x, player.y - 20));
              fireCooldown = 6;
            }
            if (fireCooldown > 0) fireCooldown--;

            // Update bullets
            for (let i = bullets.length - 1; i >= 0; i--) {
              let b = bullets[i];
              if (!b) continue;
              b.update();
              b.draw();
              if (b.dead) bullets.splice(i, 1);
            }

            // Update enemies
            for (let i = enemies.length - 1; i >= 0; i--) {
              let e = enemies[i];
              if (!e) continue;
              e.update();
              e.draw();

              // Bullet collisions
              for (let j = bullets.length - 1; j >= 0; j--) {
                const b = bullets[j];
                if (!b || b.dead) continue;
                const dist = Math.sqrt((b.x - e.x) ** 2 + (b.y - e.y) ** 2);
                if (dist < e.size + b.size + 10) {
                  b.dead = true;
                  e.hp--;
                  for (let k = 0; k < 3; k++) {
                    // Add to particles after
                  }
                  if (e.hp <= 0) {
                    e.dead = true;
                    score += e.type === 'chaser' ? 250 : 100;
                    document.getElementById('score-display').innerText = score;
                    for (let k = 0; k < 12; k++) {

                      particles.push(
                        new Particle(
                          e.x,
                          e.y,
                          e.type === 'chaser' ? '239,68,68' : '167,139,250',
                          8,
                          1.0
                        )
                      );
                    }
                    shakeAmount = 5;
                  }
                  break;
                }
              }

              // Player collision
              const pDist = Math.sqrt((player.x - e.x) ** 2 + (player.y - e.y) ** 2);
              if (pDist < e.size + 20) {
                e.dead = true;
                player.hp -= 25;
                shakeAmount = 25;
                updateHpBar();
                for (let k = 0; k < 15; k++) {
                  particles.push(new Particle(e.x, e.y, '239,68,68', 10, 1.5));

                }
                if (player.hp <= 0) {
                  isGameOver = true;
                  if (score > highScore) {
                    highScore = score;
                    try { localStorage.setItem('zenion-hs', highScore); } catch (e) { }
                  }
                  document.getElementById('high-score-display').innerText = highScore;
                  document.getElementById('final-score').innerText = score;
                  document.getElementById('game-over').classList.add('active');
                }

              }
              if (e.dead) enemies.splice(i, 1);
            }
          } else if (!gameActive) {
            // Ambient mode
            for (let a = 0; a < ambientNodes.length; a++) {
              if (!ambientNodes[a]) continue;

              for (let b = a + 1; b < ambientNodes.length; b++) {
                if (!ambientNodes[b]) continue;
                const dx = ambientNodes[a].x - ambientNodes[b].x;
                const dy = ambientNodes[a].y - ambientNodes[b].y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                if (dist < 100) {
                  ctx.strokeStyle = `rgba(${ambientNodes[a].color}, ${0.3 * (1 - dist / 100)})`;
                  ctx.lineWidth = 0.5;
                  ctx.beginPath();
                  ctx.moveTo(ambientNodes[a].x, ambientNodes[a].y);
                  ctx.lineTo(ambientNodes[b].x, ambientNodes[b].y);
                  ctx.stroke();
                }
              }
              ambientNodes[a].update();
              ambientNodes[a].draw();
            }
          }
          // --- Particles (GLOBAL RENDER PASS) ---
          for (let i = particles.length - 1; i >= 0; i--) {
            const p = particles[i];
            p.update();
            p.draw();
            if (p.life <= 0) particles.splice(i, 1);
          }

          ctx.restore();
        } catch (err) {
          console.error("Game Loop Error:", err);
        }

        requestAnimationFrame(loop);
      }

      // --- Helpers ---
      const card = document.getElementById('glass');
      const wrap = document.querySelector('.wrap');
      let ticking = false; // To throttle updates

      function updateTilt(x, y) {
        if (gameActive) return;

        // FIX: STABILITY CHECK - Stop tilting if hovering buttons
        const actionContainer = document.getElementById('action-container');
        const buttonRow = document.getElementById('button-row'); // Added this back for safety

        const isIn = (el) => {
          if (!el) return false;
          const rect = el.getBoundingClientRect();
          return x >= rect.left - 10 && x <= rect.right + 10 && y >= rect.top - 10 && y <= rect.bottom + 10;
        };

        if (
          isIn(actionContainer) ||
          isIn(buttonRow) ||
          document.activeElement?.closest('.action-btn, .holo-btn, .immersive-btn')
        ) {// Check both
          if (!ticking) {
            requestAnimationFrame(() => {
              card.style.setProperty('--rx', '0deg');
              card.style.setProperty('--ry', '0deg');
              ticking = false;
            });
            ticking = true;
          }
          return;
        }

        if (!ticking) {
          window.requestAnimationFrame(() => {
            const rect = card.getBoundingClientRect();
            const rotX = ((y - (rect.top + rect.height / 2)) / (window.innerHeight / 2)) * -8;
            const rotY = ((x - (rect.left + rect.width / 2)) / (window.innerWidth / 2)) * 8;
            card.style.setProperty('--rx', `${rotX}deg`);
            card.style.setProperty('--ry', `${rotY}deg`);
            card.style.setProperty('--mx', `${((x - rect.left) / rect.width) * 100}%`);
            card.style.setProperty('--my', `${((y - rect.top) / rect.height) * 100}%`);
            card.style.setProperty('--sheen-op', '1');
            ticking = false;
          });
          ticking = true;
        }
      }

      function fitCard() {
        const s = document.getElementById('scaler');
        if (!s) return;
        s.style.transform = 'scale(1)';
        const glass = document.getElementById('glass');
        if (!glass) return;
        const h = glass.offsetHeight;
        const w = glass.offsetWidth;
        let sc = Math.min((window.innerHeight - 40) / h, (window.innerWidth - 40) / w);
        if (sc > 1) sc = 1;
        s.style.transform = `scale(${sc})`;
        const c = document.getElementById('card');
        if (c) c.classList.add('loaded');
      }

      // Haptic Feedback Helper
      function triggerHaptic() {
        if (navigator.vibrate) {
          navigator.vibrate(10); // 10ms vibration
        }
      }

      // Attach haptics to all interactive elements
      document.querySelectorAll('.haptic-target, .immersive-btn, .holo-btn, .action-btn, .tech-chip').forEach(btn => {
        btn.addEventListener('touchstart', triggerHaptic, { passive: true });
        btn.addEventListener('mouseenter', triggerHaptic, { passive: true });
      });

      // Touch "Scrubbing" Logic
      let lastTouchedElement = null;

      wrap.addEventListener('touchmove', (e) => {
        const touch = e.touches[0];
        const target = document.elementFromPoint(touch.clientX, touch.clientY);

        const btn = target ? target.closest('.immersive-btn') : null;

        if (btn && btn !== lastTouchedElement) {
          triggerHaptic();
          if (lastTouchedElement) lastTouchedElement.classList.remove('is-hovered');
          btn.classList.add('is-hovered');
          lastTouchedElement = btn;
        } else if (!btn && lastTouchedElement) {
          lastTouchedElement.classList.remove('is-hovered');
          lastTouchedElement = null;
        }
      }, { passive: true });

      wrap.addEventListener('touchend', (e) => {
        if (lastTouchedElement) {
          e.preventDefault();       // STOP native click
          lastTouchedElement.classList.remove('is-hovered');
          lastTouchedElement = null;
        }
      }, { passive: false });


      wrap.addEventListener('mousemove', e => updateTilt(e.clientX, e.clientY), { passive: true });
      wrap.addEventListener('mouseleave', () => {
        card.style.setProperty('--rx', '0deg');
        card.style.setProperty('--ry', '0deg');
        card.style.setProperty('--sheen-op', '0');
      }, { passive: true });

      let qrInstance = null;
      const qrModal = document.getElementById('qr-modal');
      function openQR() {
        const qrContainer = document.getElementById('qr-code');
        qrContainer.innerHTML = "";

        const vCardData = `
BEGIN:VCARD
VERSION:3.0
N:Mistry;Prem;;;
FN:Prem Mistry
ORG:Zenion Technologies
TITLE:Engineer
TEL;TYPE=CELL:+919408075958
EMAIL;TYPE=WORK:info@zeniontechnologies.com
URL:https://www.zeniontechnologies.com
END:VCARD
  `.trim();

        qrInstance = new QRCode(qrContainer, {
          text: vCardData,
          width: 180,
          height: 180,
          correctLevel: QRCode.CorrectLevel.M
        });

        qrModal.classList.add('active');
      }

      document.getElementById("copyright-year").textContent =
        new Date().getFullYear();

      function closeQR() { qrModal.classList.remove('active'); }

      function showToast(msg) {
        const t = document.getElementById('toast');
        document.getElementById('toast-msg').innerText = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 2000);
      }

      async function saveContact() {
        triggerHaptic(); // Haptic feedback on click
        const vcard = "BEGIN:VCARD\nVERSION:3.0\nN:Mistry;Prem;;;\nFN:Prem Mistry\nORG:Zenion Technologies\nTEL;TYPE=CELL:+919408075958\nEMAIL:info@zeniontechnologies.com\nURL:https://www.zeniontechnologies.com\nEND:VCARD";
        const blob = new Blob([vcard], { type: "text/vcard" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "Prem Mistry.vcf";
        document.body.appendChild(a); // Appending to body is required for Firefox/iOS in some cases
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showToast("Downloading Contact...");
      }

      async function shareCard() {
        triggerHaptic(); // Haptic feedback on click

        const shareData = {
          title: "Prem Mistry",
          text: "Check out Prem Mistry's Digital Business Card",
          url: window.location.href
        };

        // Try native share first, then aggressive fallback
        try {
          if (navigator.share) {
            await navigator.share(shareData);
          } else {
            throw new Error("Web Share API not supported");
          }
        } catch (err) {
          // If user canceled, do nothing (usually AbortError). 
          // For everything else (or if browser doesn't support it), copy to clipboard.
          if (err.name !== 'AbortError') {
            copyToClipboardFallback();
          }
        }
      }

      function copyToClipboardFallback() {
        const text = window.location.href;

        // Try Modern Async Clipboard API
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(text)
            .then(() => showToast("Link Copied"))
            .catch(() => fallbackExecCommand(text));
        } else {
          // Fallback to legacy execCommand
          fallbackExecCommand(text);
        }
      }

      function fallbackExecCommand(text) {
        const textArea = document.createElement("textarea");
        textArea.value = text;

        // Ensure it's not visible but part of the DOM
        textArea.style.position = "fixed";
        textArea.style.left = "-9999px";
        textArea.style.top = "0";
        document.body.appendChild(textArea);

        textArea.focus();
        textArea.select();

        try {
          const successful = document.execCommand('copy');
          if (successful) {
            showToast("Link Copied");
          } else {
            showToast("Copy Failed");
          }
        } catch (err) {
          showToast("Copy Failed");
        }

        document.body.removeChild(textArea);
      }

      function openWhatsApp() {
        window.open(`https://wa.me/919408075958?text=${encodeURIComponent("Hi Prem, I found your digital card!")}`, '_blank');
      }

      function downloadQR() {
        const qrContainer = document.getElementById('qr-code');
        // QRCode.js might render as an IMG or a CANVAS depending on the browser
        const img = qrContainer.querySelector("img");
        const canvas = qrContainer.querySelector("canvas");
        let url = "";

        if (img && img.src) {
          url = img.src;
        } else if (canvas) {
          url = canvas.toDataURL("image/png");
        }

        if (url) {
          const a = document.createElement('a');
          a.href = url;
          a.download = "prem-mistry-qr.png";
          document.body.appendChild(a); // Required for Firefox
          a.click();
          document.body.removeChild(a);
          showToast("QR Saved");
        } else {
          showToast("Error saving QR");
        }
      }

      /* ===== PWA: safe install flow + SW registration =====
         - waits for DOMContentLoaded to avoid race with beforeinstallprompt
         - registers service worker from root (/sw.js)
         - shows install button only when prompt is available
      */
      document.addEventListener('DOMContentLoaded', () => {
        let deferredPrompt = null;
        const installBtn = document.getElementById('pwa-install-btn');

        // If app is already standalone, hide install button
        if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
          if (installBtn) installBtn.classList.add('hidden');
        }

        // Register service worker (root path recommended)
        if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js')
    .then(() => console.log('SW registered'))
    .catch(err => console.error('SW failed', err));
}


        // Listen for install prompt availability
        window.addEventListener('beforeinstallprompt', (e) => {
          e.preventDefault(); // stop automatic mini-infobar
          deferredPrompt = e;
          if (installBtn) {
            installBtn.classList.remove('hidden');
            installBtn.setAttribute('aria-hidden', 'false');
          }
        });

        // Expose a global installPWA() for the button's onclick
        window.installPWA = async function () {
          triggerHaptic();
          if (!deferredPrompt) return;
          try {
            deferredPrompt.prompt();
            const choice = await deferredPrompt.userChoice;
            if (choice && choice.outcome === 'accepted') {
              showToast('App Installed');
            } else {
              showToast('Install dismissed');
            }
          } catch (err) {
            console.warn('Install prompt failed:', err);
          } finally {
            deferredPrompt = null;
            if (installBtn) {
              installBtn.classList.add('hidden');
              installBtn.setAttribute('aria-hidden', 'true');
            }
          }
        };

        // Hide install button once installed
        window.addEventListener('appinstalled', () => {
          const installBtn = document.getElementById('pwa-install-btn');
          if (installBtn) installBtn.classList.add('hidden');
          console.log('PWA installed');
        });
      });

      window.addEventListener('resize', resize, { passive: true });
      window.onload = () => {
        resize();
        loop(0);
        setTimeout(fitCard, 100);
      };
    </script>
</body>

</html>




